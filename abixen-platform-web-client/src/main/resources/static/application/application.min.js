var platformParameters={events:{ADF_TOGGLE_EDIT_MODE_EVENT:"ADF_TOGGLE_EDIT_MODE",ADF_TOGGLE_EDIT_MODE_RESPONSE_EVENT:"ADF_TOGGLE_EDIT_MODE_INVOKED",ADF_ADD_WIDGET_EVENT:"ADF_ADD_WIDGET",ADF_EDIT_DASHBOARD_EVENT:"ADF_EDIT_DASHBOARD",ADF_WIDGET_DELETED_EVENT:"ADF_WIDGET_DELETED",ADF_STRUCTURE_CHANGED_EVENT:"ADF_STRUCTURE_CHANGED",ADF_DASHBOARD_CHANGED_EVENT:"ADF_DASHBOARD_CHANGED",MODULE_READY:"MODULE_READY",RELOAD_MODULE:"RELOAD_MODULE",MODULE_FORBIDDEN:"MODULE_FORBIDDEN",START_REQUEST:"START_REQUEST",STOP_REQUEST:"STOP_REQUEST",SHOW_LOADER:"SHOW_LOADER",HIDE_LOADER:"HIDE_LOADER",SHOW_PERMISSION_DENIED_TO_MODULE:"SHOW_PERMISSION_DENIED_TO_MODULE",SIDEBAR_ELEMENT_SELECTED:"SIDEBAR_ELEMENT_SELECTED"},statusAlertTypes:{SUCCESS:"success",ERROR:"error",WARNING:"warning",NOTE:"note",WAIT:"wait"}},platformApplication=angular.module("platformApplication",["platformNavigationModule","platformApplicationControllers","platformApplicationServices","platformApplicationDirectives","platformPageModule","ngAnimate","ui.router","ui.bootstrap","ngAside","adf.provider","ui.bootstrap.showErrors","toaster","xeditable","platformChartModule","platformMagicNumberModule","platformKpiChartModule","platformUserModule","platformModalModule"]);platformApplication.factory("platformHttpInterceptor",["$q","$injector",function(a,b){var c="http://localhost:8080/login",d="/application/modules";return{responseError:function(e){if(console.log("rejection: ",e),e.data&&e.data.path&&0==e.data.path.indexOf(d)&&401!=e.status&&403!=e.status&&500!=e.status)return a.reject(e);if(401==e.status)window.location=c;else if(403==e.status){var f=b.get("toaster");f.pop(platformParameters.statusAlertTypes.ERROR,e.data.error,e.data.message)}else if(500==e.status){var f=b.get("toaster");f.pop(platformParameters.statusAlertTypes.ERROR,e.data.error,e.data.message)}return a.reject(e)}}}]),platformApplication.config(["$httpProvider","$stateProvider","$urlRouterProvider","modalWindowProvider",function(a,b,c,d){a.interceptors.push("platformHttpInterceptor"),a.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",c.otherwise("/"),b.state("application",{abstract:!0,controller:"PlatformInitController",templateUrl:"/application/html/index.html"}),d.setOkButtonClass("btn save-button add-module-btton"),d.setCancelButtonClass("btn cancel-button"),d.setWarningWindowClass("warning-modal")}]),platformApplication.directive("dynamicName",function(a,b){return{restrict:"A",terminal:!0,priority:1e5,link:function(b,c){var d=c.attr("dynamic-name");c.removeAttr("dynamic-name"),c.attr("name",d),a(c)(b)}}}),platformApplication.run(function(a,b){a.theme="bs3",b.bs3.submitTpl='<button type="submit" class="btn save-button"><i class="fa fa-floppy-o"></i></button>',b.bs3.cancelTpl='<button type="button" class="btn cancel-button" ng-click="$form.$cancel()"><i class="fa fa-times"></i></button>'});var platformControllers=angular.module("platformApplicationControllers",[]);platformControllers.controller("PlatformInitController",["$rootScope","$scope","$http","$location","$log","$state","applicationNavigationItems","$aside","Page","ModuleType","dashboard","toaster","modalWindow",function(a,b,c,d,e,f,g,h,i,j,k,l,m){e.log("PlatformInitController");var n="http://localhost:8080/login",o="http://localhost:8080/admin";b.platformUser=null,b.logout=function(){c.get("/user",{headers:{authorization:"Basic "+btoa(":")}}).success(function(){window.location=n}).error(function(a){e.error(a),window.location=n})};var p=function(){c.get("/user",{}).success(function(a){b.platformUser=a,e.log("platformUser: ",b.platformUser)})};p(),b.showDropdown=!1;var q={id:1,styleClass:"btn add-new-page-button",faIcon:"fa fa-plus",title:"Add Page",onClick:function(){h.open({placement:"left",templateUrl:"/application/modules/page/html/add.html",size:"md",backdrop:!1,controller:"PageDetailsController"})},visible:!0,disabled:!1},r={id:2,styleClass:"btn edit-mode-button",faIcon:"fa fa-pencil-square-o",title:"Edit Mode",onClick:function(){b.$broadcast(platformParameters.events.ADF_TOGGLE_EDIT_MODE_EVENT),s.visible=!s.visible,b.showDropdown=!b.showDropdown},visible:!0,disabled:!1};g.addTopbarItem(q).addTopbarItem(r);var s={id:1,title:"Edit page",onClick:function(){b.$broadcast(platformParameters.events.ADF_EDIT_DASHBOARD_EVENT)},isSeparator:!1},t={id:2,title:"Delete Page",onClick:function(){var a=function(){i.delete({id:f.params.id},function(a){l.pop(platformParameters.statusAlertTypes.SUCCESS,"Deleted","A page has been deleted successfully.");var c=platformApplicationUtils.findObjectInArray("id",f.params.id,g.sidebarItems);c&&g.sidebarItems.splice(g.sidebarItems.indexOf(c),1),g.sidebarItems.length>0?(f.go(g.sidebarItems[0].state,{id:g.sidebarItems[0].id}),b.$broadcast(platformParameters.events.SIDEBAR_ELEMENT_SELECTED,g.sidebarItems[0].id)):f.go("application.welcome")})};m.openConfirmWindow("Delete page?","The page will be deleted permanently. Are you sure you want to perform this operation?","warning",a)},isSeparator:!1},u={id:3,title:"",styleClass:"divider",isSeparator:!0},v={id:4,title:"Add Module",onClick:function(){b.$broadcast(platformParameters.events.ADF_ADD_WIDGET_EVENT)},isSeparator:!1};g.addTopbarDropdownItem(s).addTopbarDropdownItem(t).addTopbarDropdownItem(u).addTopbarDropdownItem(v),g.setDropdownStyleClass("btn-group action-dropdown");var w=function(){i.query(function(a){for(var c=a.content,d=0;d<c.length;d++)g.addSidebarItem({id:c[d].id,title:c[d].title,state:"application.page",orderIndex:d,isPage:!0,iconClass:"fa fa-file-text-o"});if(c.length>0){var e;e=f.params.id?f.params.id:c[0].id,"application.page"==f.current.name&&(f.go("application.page",{id:e}),b.$broadcast(platformParameters.events.SIDEBAR_ELEMENT_SELECTED,e))}else r.visible=!1,f.go("application.welcome")})},x=function(){j.query(function(a){for(var b=0;b<a.length;b++){var c=a[b];k.widget(c.name,{id:null,title:c.title,description:c.description,templateUrl:c.initUrl,edit:{reload:!1},moduleType:c})}w()})};x(),a.$on("$stateChangeSuccess",function(a,c,d,e,f){b.editMode=!1,r.title="Edit Mode","application.welcome"==c.name?r.visible=!1:"application.page"==c.name&&(r.visible=g.getSidebarItems().length>0),b.showDropdown=!1});var y={title:"Admin Page",onClick:function(){b.showDropdown=!1,window.location=o}};g.setRedirectAction(y),b.editUser=function(){h.open({placement:"left",templateUrl:"/application/modules/user/html/edit.html",size:"md",backdrop:!1,controller:"UserDetailsController",resolve:{userId:function(){return b.platformUser.id}}})},b.$on(platformParameters.events.ADF_TOGGLE_EDIT_MODE_RESPONSE_EVENT,function(a,c){e.log("toggle edit mode invoked, editMode: ",c),b.editMode=c,r.title=b.editMode?"View Mode":"Edit Mode"})}]);var platformApplicationDirectives=angular.module("platformApplicationDirectives",[]),CONTENT_HEIGHT_OFFSET=175;platformApplicationDirectives.directive("windowResize",["$window","$timeout",function(a,b){function c(c,d,e){c.height=a.innerHeight,c.redraw=function(a){for(var b={width:window.innerWidth||document.body.clientWidth,height:window.innerHeight||document.body.clientHeight},c=angular.element(document),e=angular.element(c.find("form-container")),f=0,g=0;g<e.length;g++)f+=e[g].offsetHeight;var h=b.height-f-CONTENT_HEIGHT_OFFSET;angular.element(d[0]).css("height",h+"px")},c.redraw(),b(function(){c.redraw()},500),angular.element(a).bind("resize",function(){c.redraw()})}return{link:c,scope:{header:"@header",body:"@body",footer:"@footer"}}}]);var platformServices=angular.module("platformApplicationServices",["ngResource","adf.provider"]);platformServices.factory("ModuleType",["$resource",function(a){return a("/api/user/pages/module-types",{},{query:{method:"GET",isArray:!0}})}]),platformServices.factory("User",["$resource",function(a){return a("/api/application/users/:id",{},{query:{method:"GET",isArray:!1},update:{method:"PUT"}})}]),platformServices.factory("UserRole",["$resource",function(a){return a("/api/application/users/:id/roles",{},{query:{method:"GET",isArray:!1},update:{method:"PUT"}})}]),platformServices.factory("UserPassword",["$resource",function(a){return a("/api/application/users/:id/password",{},{update:{method:"POST"}})}]);var platformApplicationUtils={findObjectInArray:function(a,b,c){for(var d=0;d<c.length;d++)if(c[d][a]==b)return c[d]}};