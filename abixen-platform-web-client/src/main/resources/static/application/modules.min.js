var platformParameters={events:{ADF_TOGGLE_EDIT_MODE_EVENT:"ADF_TOGGLE_EDIT_MODE",ADF_TOGGLE_EDIT_MODE_RESPONSE_EVENT:"ADF_TOGGLE_EDIT_MODE_INVOKED",ADF_ADD_WIDGET_EVENT:"ADF_ADD_WIDGET",ADF_EDIT_DASHBOARD_EVENT:"ADF_EDIT_DASHBOARD",ADF_WIDGET_DELETED_EVENT:"ADF_WIDGET_DELETED",ADF_STRUCTURE_CHANGED_EVENT:"ADF_STRUCTURE_CHANGED",ADF_DASHBOARD_CHANGED_EVENT:"ADF_DASHBOARD_CHANGED",MODULE_READY:"MODULE_READY",RELOAD_MODULE:"RELOAD_MODULE",MODULE_FORBIDDEN:"MODULE_FORBIDDEN",START_REQUEST:"START_REQUEST",STOP_REQUEST:"STOP_REQUEST",SHOW_LOADER:"SHOW_LOADER",HIDE_LOADER:"HIDE_LOADER",SHOW_PERMISSION_DENIED_TO_MODULE:"SHOW_PERMISSION_DENIED_TO_MODULE",SIDEBAR_ELEMENT_SELECTED:"SIDEBAR_ELEMENT_SELECTED"},statusAlertTypes:{SUCCESS:"success",ERROR:"error",WARNING:"warning",NOTE:"note",WAIT:"wait"}},platformApplication=angular.module("platformApplication",["platformNavigationModule","platformApplicationControllers","platformApplicationServices","platformApplicationDirectives","platformPageModule","ngAnimate","ui.router","ui.bootstrap","ngAside","adf.provider","ui.bootstrap.showErrors","toaster","xeditable","platformChartModule","platformMagicNumberModule","platformKpiChartModule","platformUserModule","platformModalModule"]);platformApplication.factory("platformHttpInterceptor",["$q","$injector",function(a,b){var c="http://localhost:8080/login",d="/application/modules";return{responseError:function(e){if(console.log("rejection: ",e),e.data&&e.data.path&&0==e.data.path.indexOf(d)&&401!=e.status&&403!=e.status&&500!=e.status)return a.reject(e);if(401==e.status)window.location=c;else if(403==e.status){var f=b.get("toaster");f.pop(platformParameters.statusAlertTypes.ERROR,e.data.error,e.data.message)}else if(500==e.status){var f=b.get("toaster");f.pop(platformParameters.statusAlertTypes.ERROR,e.data.error,e.data.message)}return a.reject(e)}}}]),platformApplication.config(["$httpProvider","$stateProvider","$urlRouterProvider","modalWindowProvider",function(a,b,c,d){a.interceptors.push("platformHttpInterceptor"),a.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",c.otherwise("/"),b.state("application",{abstract:!0,controller:"PlatformInitController",templateUrl:"/application/html/index.html"}),d.setOkButtonClass("btn save-button add-module-btton"),d.setCancelButtonClass("btn cancel-button"),d.setWarningWindowClass("warning-modal")}]),platformApplication.directive("dynamicName",function(a,b){return{restrict:"A",terminal:!0,priority:1e5,link:function(b,c){var d=c.attr("dynamic-name");c.removeAttr("dynamic-name"),c.attr("name",d),a(c)(b)}}}),platformApplication.run(function(a,b){a.theme="bs3",b.bs3.submitTpl='<button type="submit" class="btn save-button"><i class="fa fa-floppy-o"></i></button>',b.bs3.cancelTpl='<button type="button" class="btn cancel-button" ng-click="$form.$cancel()"><i class="fa fa-times"></i></button>'});var platformControllers=angular.module("platformApplicationControllers",[]);platformControllers.controller("PlatformInitController",["$rootScope","$scope","$http","$location","$log","$state","applicationNavigationItems","$aside","Page","ModuleType","dashboard","toaster","modalWindow",function(a,b,c,d,e,f,g,h,i,j,k,l,m){e.log("PlatformInitController");var n="http://localhost:8080/login",o="http://localhost:8080/admin";b.platformUser=null,b.logout=function(){c.get("/user",{headers:{authorization:"Basic "+btoa(":")}}).success(function(){window.location=n}).error(function(a){e.error(a),window.location=n})};var p=function(){c.get("/user",{}).success(function(a){b.platformUser=a,e.log("platformUser: ",b.platformUser)})};p(),b.showDropdown=!1;var q={id:1,styleClass:"btn add-new-page-button",faIcon:"fa fa-plus",title:"Add Page",onClick:function(){h.open({placement:"left",templateUrl:"/application/modules/page/html/add.html",size:"md",backdrop:!1,controller:"PageDetailsController"})},visible:!0,disabled:!1},r={id:2,styleClass:"btn edit-mode-button",faIcon:"fa fa-pencil-square-o",title:"Edit Mode",onClick:function(){b.$broadcast(platformParameters.events.ADF_TOGGLE_EDIT_MODE_EVENT),s.visible=!s.visible,b.showDropdown=!b.showDropdown},visible:!0,disabled:!1};g.addTopbarItem(q).addTopbarItem(r);var s={id:1,title:"Edit page",onClick:function(){b.$broadcast(platformParameters.events.ADF_EDIT_DASHBOARD_EVENT)},isSeparator:!1},t={id:2,title:"Delete Page",onClick:function(){var a=function(){i.delete({id:f.params.id},function(a){l.pop(platformParameters.statusAlertTypes.SUCCESS,"Deleted","A page has been deleted successfully.");var c=platformApplicationUtils.findObjectInArray("id",f.params.id,g.sidebarItems);c&&g.sidebarItems.splice(g.sidebarItems.indexOf(c),1),g.sidebarItems.length>0?(f.go(g.sidebarItems[0].state,{id:g.sidebarItems[0].id}),b.$broadcast(platformParameters.events.SIDEBAR_ELEMENT_SELECTED,g.sidebarItems[0].id)):f.go("application.welcome")})};m.openConfirmWindow("Delete page?","The page will be deleted permanently. Are you sure you want to perform this operation?","warning",a)},isSeparator:!1},u={id:3,title:"",styleClass:"divider",isSeparator:!0},v={id:4,title:"Add Module",onClick:function(){b.$broadcast(platformParameters.events.ADF_ADD_WIDGET_EVENT)},isSeparator:!1};g.addTopbarDropdownItem(s).addTopbarDropdownItem(t).addTopbarDropdownItem(u).addTopbarDropdownItem(v),g.setDropdownStyleClass("btn-group action-dropdown");var w=function(){i.query(function(a){for(var c=a.content,d=0;d<c.length;d++)g.addSidebarItem({id:c[d].id,title:c[d].title,state:"application.page",orderIndex:d,isPage:!0,iconClass:"fa fa-file-text-o"});if(c.length>0){var e;e=f.params.id?f.params.id:c[0].id,"application.page"==f.current.name&&(f.go("application.page",{id:e}),b.$broadcast(platformParameters.events.SIDEBAR_ELEMENT_SELECTED,e))}else r.visible=!1,f.go("application.welcome")})},x=function(){j.query(function(a){for(var b=0;b<a.length;b++){var c=a[b];k.widget(c.name,{id:null,title:c.title,description:c.description,templateUrl:c.initUrl,edit:{reload:!1},moduleType:c})}w()})};x(),a.$on("$stateChangeSuccess",function(a,c,d,e,f){b.editMode=!1,r.title="Edit Mode","application.welcome"==c.name?r.visible=!1:"application.page"==c.name&&(r.visible=g.getSidebarItems().length>0),b.showDropdown=!1});var y={title:"Admin Page",onClick:function(){b.showDropdown=!1,window.location=o}};g.setRedirectAction(y),b.editUser=function(){h.open({placement:"left",templateUrl:"/application/modules/user/html/edit.html",size:"md",backdrop:!1,controller:"UserDetailsController",resolve:{userId:function(){return b.platformUser.id}}})},b.$on(platformParameters.events.ADF_TOGGLE_EDIT_MODE_RESPONSE_EVENT,function(a,c){e.log("toggle edit mode invoked, editMode: ",c),b.editMode=c,r.title=b.editMode?"View Mode":"Edit Mode"})}]);var platformApplicationDirectives=angular.module("platformApplicationDirectives",[]),CONTENT_HEIGHT_OFFSET=175;platformApplicationDirectives.directive("windowResize",["$window","$timeout",function(a,b){function c(c,d,e){c.height=a.innerHeight,c.redraw=function(a){for(var b={width:window.innerWidth||document.body.clientWidth,height:window.innerHeight||document.body.clientHeight},c=angular.element(document),e=angular.element(c.find("form-container")),f=0,g=0;g<e.length;g++)f+=e[g].offsetHeight;var h=b.height-f-CONTENT_HEIGHT_OFFSET;angular.element(d[0]).css("height",h+"px")},c.redraw(),b(function(){c.redraw()},500),angular.element(a).bind("resize",function(){c.redraw()})}return{link:c,scope:{header:"@header",body:"@body",footer:"@footer"}}}]);var platformServices=angular.module("platformApplicationServices",["ngResource","adf.provider"]);platformServices.factory("ModuleType",["$resource",function(a){return a("/api/user/pages/module-types",{},{query:{method:"GET",isArray:!0}})}]),platformServices.factory("User",["$resource",function(a){return a("/api/application/users/:id",{},{query:{method:"GET",isArray:!1},update:{method:"PUT"}})}]),platformServices.factory("UserRole",["$resource",function(a){return a("/api/application/users/:id/roles",{},{query:{method:"GET",isArray:!1},update:{method:"PUT"}})}]),platformServices.factory("UserPassword",["$resource",function(a){return a("/api/application/users/:id/password",{},{update:{method:"POST"}})}]);var platformApplicationUtils={findObjectInArray:function(a,b,c){for(var d=0;d<c.length;d++)if(c[d][a]==b)return c[d]}};angular.module("adf",["adf.provider","ui.bootstrap"]).value("adfTemplatePath","/application/modules/dashboard/html/").value("rowTemplate",'<adf-dashboard-row row="row" adf-model="adfModel" options="options" edit-mode="editMode" ng-repeat="row in column.rows" />').value("columnTemplate",'<adf-dashboard-column column="column" adf-model="adfModel" options="options" edit-mode="editMode" ng-repeat="column in row.columns" />').value("adfVersion","<<adfVersion>>"),angular.module("adf").directive("adfDashboardColumn",["$log","$compile","adfTemplatePath","rowTemplate","dashboard",function(a,b,c,d,e){"use strict";function f(a,b,c){var d=b.widgets;a.$apply(function(){d.splice(c.newIndex,0,d.splice(c.oldIndex,1)[0])})}function g(a,b){for(var c=null,d=0;d<a.widgets.length;d++){var e=a.widgets[d];if(e.wid===b){c=e;break}}return c}function h(a,b){for(var c=null,d=0;d<a.rows.length;d++){for(var e=a.rows[d],f=0;f<e.columns.length;f++){var g=e.columns[f];if(g.cid===b){c=g;break}g.rows&&(c=h(g,b))}if(c)break}return c}function i(a){var b=a.getAttribute("adf-id");return b?parseInt(b):-1}function j(b,c,d,e){var f=i(e.from),j=h(c,f);if(j){var k=i(e.item),l=g(j,k);l?b.$apply(function(){d.widgets||(d.widgets=[]),d.widgets.splice(e.newIndex,0,l)}):a.warn("could not find widget with id "+k)}else a.warn("could not find column with id "+f)}function k(a,b,c){a.$apply(function(){b.widgets.splice(c.oldIndex,1)})}function l(a,b,c,d){var e=b[0].childNodes[0],g=Sortable.create(e,{group:"widgets",handle:".adf-move",ghostClass:"placeholder",animation:150,onAdd:function(b){j(a,c,d,b)},onRemove:function(b){k(a,d,b)},onUpdate:function(b){f(a,d,b)}});b.on("$destroy",function(){g.destroy()})}return{restrict:"E",replace:!0,scope:{column:"=",editMode:"=",adfModel:"=",options:"="},templateUrl:c+"dashboard-column.html",link:function(a,c){var f=a.column;f.cid||(f.cid=e.id()),angular.isDefined(f.rows)&&angular.isArray(f.rows)?b(d)(a,function(a){c.append(a)}):l(a,c,a.adfModel,f)}}}]),angular.module("adf").directive("adfDashboard",["$rootScope","$log","dashboard","adfTemplatePath","$aside","applicationNavigationItems","$stateParams",function(a,b,c,d,e,f,g){"use strict";function h(a){switch(angular.isDefined(a)?a.toLowerCase():null){case"true":case"yes":case"1":return!0;case"false":case"no":case"0":case null:return!1;default:return Boolean(a)}}function i(a,b){if(a.widgets&&a.widgets.length>0)for(var c=a.widgets.shift();c;)b.widgets.push(c),c=a.widgets.shift()}function j(a,b,c){return c=c||0,angular.isDefined(a.rows)&&angular.forEach(a.rows,function(a){angular.forEach(a.columns,function(a){a.widgets||(a.widgets=[]),angular.isDefined(b[c])&&(angular.isDefined(a.rows)||(i(b[c],a),c++)),c=j(a,b,c)})}),c}function k(a,b){return b=b||[],angular.isDefined(a.rows)&&angular.forEach(a.rows,function(a){angular.forEach(a.columns,function(a){b.push(a),k(a,b)})}),b}function l(a,b){var c=k(a),d=0;for(a.rows=angular.copy(JSON.parse(b.content).rows),a.structure=b.title;d<c.length;)d=j(a,c,d)}function m(a){var b={},d=c.widgets[a].config;return d&&(b=angular.copy(d)),b}function n(a){var c=null;if(!angular.isArray(a.rows))return b.error("model does not have any rows"),null;for(var d=0;d<a.rows.length;d++){var e=a.rows[d];if(angular.isArray(e.columns))for(var f=0;f<e.columns.length;f++){var g=e.columns[f];if(!g.rows){c=g;break}}if(c)break}return c}function o(a,c){if(a){var d=n(a);d?(d.widgets||(d.widgets=[]),d.widgets.unshift(c)):b.error("could not find first widget column")}else b.error("model is undefined")}return b.log("DASHBOARD"),{replace:!0,restrict:"EA",transclude:!1,scope:{structure:"@",name:"@",collapsible:"@",editable:"@",maximizable:"@",adfModel:"=",adfWidgetFilter:"="},controller:function(h){var i={},j={},k=null,n={},p=h.name;h.$on(platformParameters.events.ADF_WIDGET_DELETED_EVENT,function(a){h.$emit(platformParameters.events.ADF_DASHBOARD_CHANGED_EVENT,h.name,h.adfModel)}),h.$watch("adfModel",function(a,d){b.log("CHANGED!!!!!!!!!!!!!!!!!!!!!"),(null!==d||null===a&&null===d)&&(i=h.adfModel,k=h.adfWidgetFilter,i&&i.rows||(n=h.structure,j=c.structures[n],j?(i?i.rows=angular.copy(j).rows:i=angular.copy(j),i.structure=n):b.error("could not find structure "+n)),i?(i.title||(i.title="Dashboard"),i.description||(i.description=""),h.model=i):b.error("could not find or create model"))},!0),h.editMode=!1,h.editClass="",h.toggleEditMode=function(a){h.editMode=!h.editMode,h.editMode&&(h.modelCopy=angular.copy(h.adfModel,{})),h.editMode||a||h.$emit(platformParameters.events.ADF_DASHBOARD_CHANGED_EVENT,p,i)},h.$on(platformParameters.events.ADF_TOGGLE_EDIT_MODE_EVENT,function(a,b){h.toggleEditMode(b),h.$emit(platformParameters.events.ADF_TOGGLE_EDIT_MODE_RESPONSE_EVENT,h.editMode)}),h.collapseAll=function(b){a.$broadcast("adfDashboardCollapseExapand",{collapseExpandStatus:b})},h.editDashboardDialog=function(){var j=h.$new();j.copy={title:i.title,description:i.description},j.structures=c.structures;var k=e.open({scope:j,placement:"left",templateUrl:d+"dashboard-edit.html",size:"md",backdrop:"static"});h.changeStructure=function(c,d){b.info("change structure to "+c),l(i,d),a.$broadcast(platformParameters.events.ADF_STRUCTURE_CHANGED_EVENT,d)},j.closeDialog=function(){return j.copy.title?(i.title=j.copy.title,k.dismiss(),j.$destroy(),f.editSidebarItem(g.id,i.title),void h.$emit(platformParameters.events.ADF_DASHBOARD_CHANGED_EVENT,p,i)):(b.log("Form is invalid and could not be saved."),void j.$broadcast("show-errors-check-validity"))},j.cancelDialog=function(){k.dismiss(),j.$destroy()}},h.$on(platformParameters.events.ADF_EDIT_DASHBOARD_EVENT,function(a){h.editDashboardDialog()}),h.addWidgetDialog=function(){var a,b=h.$new(),f=h.model;angular.isFunction(k)?(a={},angular.forEach(c.widgets,function(b,c){k(b,c,f)&&(a[c]=b)})):a=c.widgets,b.widgets=a;var g={scope:b,placement:"left",templateUrl:d+"widget-add.html",size:"sx",backdrop:"static"},i=e.open(g);b.addWidget=function(a,d){var e={id:d.id,type:a,title:d.title,moduleType:d.moduleType,config:m(a),wid:c.id()};o(f,e),h.$emit(platformParameters.events.ADF_DASHBOARD_CHANGED_EVENT,p,f),i.dismiss(),b.$destroy()},b.closeDialog=function(){i.dismiss(),b.$destroy()}},h.$on(platformParameters.events.ADF_ADD_WIDGET_EVENT,function(a){h.addWidgetDialog()})},link:function(a,b,c){a.$on("FULL_SCREEN_MODE",function(a,b,c){var d=angular.element(document.getElementById("dashboard-sub-container"));if(c){d.addClass("hidden");var e=angular.element(document.getElementById("dashboard-container")),f=angular.element(document.getElementById("module-content-"+b)),g=angular.element('<div class="container-fluid modules-wrapper custom-column-container ng-scope ng-isolate-scope" id="adf-dashboard-row-full-screen"><div class="column ng-pristine ng-untouched ng-valid ng-scope ng-isolate-scope col-md-12"><div id="module-full-screen" class="module"></div></div></div>');e.append(g);var h=angular.element(document.getElementById("module-full-screen"));h.append(f)}else{d.removeClass("hidden");var f=angular.element(document.getElementById("module-content-"+b)),g=angular.element(document.getElementById("module-"+b));g.append(f);var h=angular.element(document.getElementById("adf-dashboard-row-full-screen"));h.remove()}});var d={name:c.name,editable:!0,enableConfirmDelete:h(c.enableconfirmdelete),maximizable:h(c.maximizable),collapsible:h(c.collapsible)};angular.isDefined(c.editable)&&(d.editable=h(c.editable)),a.options=d},templateUrl:d+"dashboard.html"}}]),angular.module("adf.provider",[]).provider("dashboard",function(){var a={},b="",c={},d='<div class="alert alert-danger">{}</div>',e='      <div class="progress progress-striped active">\n        <div class="progress-bar" role="progressbar" style="width: 100%">\n          <span class="sr-only">loading ...</span>\n        </div>\n      </div>';this.widget=function(b,c){var d=angular.extend({reload:!1},c);if(d.edit){var e={reload:!0};angular.extend(e,d.edit),d.edit=e}return a[b]=d,this},this.widgetsPath=function(a){return b=a,this},this.structure=function(a,b){return c[a]=b,this},this.messageTemplate=function(a){return d=a,this},this.loadingTemplate=function(a){return e=a,this},this.$get=function(){var f=0;return{widgets:a,widgetsPath:b,structures:c,messageTemplate:d,loadingTemplate:e,structure:this.structure,widget:this.widget,id:function(){return++f}}}}),angular.module("adf").directive("adfDashboardRow",["$compile","adfTemplatePath","columnTemplate",function(a,b,c){"use strict";return{restrict:"E",replace:!0,scope:{row:"=",adfModel:"=",editMode:"=",options:"="},templateUrl:b+"dashboard-row.html",link:function(b,d){angular.isDefined(b.row.columns)&&angular.isArray(b.row.columns)&&a(c)(b,function(a){d.append(a)})}}}]),angular.module("adf").directive("adfWidgetContent",["$log","$q","$sce","$http","$templateCache","$compile","$controller","$injector","$rootScope","dashboard","$timeout","$stateParams",function(a,b,c,d,e,f,g,h,i,j,k,l){function m(a){var b=a;return a.indexOf("{widgetsPath}")>=0&&(b=a.replace("{widgetsPath}",j.widgetsPath).replace("//","/"),0===b.indexOf("/")&&(b=b.substring(1))),b}function n(a){var f=b.defer();if(a.template)f.resolve(a.template);else if(a.templateUrl){var g=e.get(a.templateUrl);if(g)f.resolve(g);else{var h=c.getTrustedResourceUrl(m(a.templateUrl));d.get(h).success(function(b){e.put(a.templateUrl,b),f.resolve(b)}).error(function(){f.reject("could not load template")})}}return f.promise}function o(c,d,e){var i=c.model,k=c.content;d.html(j.loadingTemplate);var l=c.$new();i.config||(i.config={}),l.config=i.config;var m={$scope:l,widget:i,config:i.config},o={};return o.$tpl=n(k),k.resolve&&angular.forEach(k.resolve,function(a,b){angular.isString(a)?o[b]=h.get(a):o[b]=h.invoke(a,a,m)}),b.all(o).then(function(a){angular.extend(a,m);var b=a.$tpl;if(d.html(b),k.controller){var c=g(k.controller,a);k.controllerAs&&(l[k.controllerAs]=c),d.children().data("$ngControllerController",c)}f(d.contents())(l)},function(b){var c="Could not resolve all promises";b&&(c+=": "+b),a.warn(c),d.html(j.messageTemplate.replace(/{}/g,c))}),e&&e.$destroy(),l}return a.log("adf adfWidgetContent +++ !!!!!!!!!"),{replace:!0,restrict:"EA",transclude:!1,scope:{model:"=",content:"="},link:function(b,c){var d=o(b,c,null);b.$on("widgetConfigChanged",function(){d=o(b,c,d)}),b.$on("widgetReload",function(){d=o(b,c,d)}),a.log("Before binding module ready"),b.$on(platformParameters.events.MODULE_READY,function(){null!=b.model.id&&(a.log("Will reload module id: "+b.model.id),b.$broadcast(platformParameters.events.RELOAD_MODULE,b.model.id,l.mode))}),b.$on(platformParameters.events.MODULE_FORBIDDEN,function(){a.log("Will show module is forbidden: "+b.model.id),b.$emit(platformParameters.events.SHOW_PERMISSION_DENIED_TO_MODULE)}),b.$on(platformParameters.events.START_REQUEST,function(){a.log("Will show loader: "+b.model.id),b.$emit(platformParameters.events.SHOW_LOADER)}),b.$on(platformParameters.events.STOP_REQUEST,function(){a.log("Will hide loader: "+b.model.id),b.$emit(platformParameters.events.HIDE_LOADER)}),b.$watch("model.id",function(a,c){null==c&&null!=a&&b.$broadcast(platformParameters.events.RELOAD_MODULE,a,l.mode)},!0)}}}]),angular.module("adf").directive("adfWidget",["$log","$uibModal","$rootScope","dashboard","adfTemplatePath","modalWindow",function(a,b,c,d,e,f){function g(b){var c=b.definition;if(a.log("preLink adf widget !!!!!!!!!",c),c){var f=d.widgets[c.type];if(f){c.title||(c.title=f.title),c.titleTemplateUrl||(c.titleTemplateUrl=e+"widget-title.html"),c.wid||(c.wid=d.id()),b.widget=angular.copy(f);var g=c.config;g?angular.isString(g)&&(g=angular.fromJson(g)):g={},b.config=g,b.widgetState||(b.widgetState={},b.widgetState.isCollapsed=!1,b.widgetState.isLoading=!1,b.widgetState.permissionDenied=!1)}else a.warn("could not find widget "+c.type)}else a.debug("definition not specified, widget was probably removed")}function h(b,c){if(b.definition){var d=function(){var a=b.col;if(a){var d=a.widgets.indexOf(b.definition);d>=0&&a.widgets.splice(d,1)}c.remove(),b.$emit(platformParameters.events.ADF_WIDGET_DELETED_EVENT)};b.remove=function(){f.openConfirmWindow("Delete module?","The module will be deleted permanently. Are you sure you want to perform this operation?","warning",d)},b.reload=function(){b.$broadcast("widgetReload")},b.edit=function(){b.$broadcast("CONFIGURATION_MODE",b.definition.id)}}else a.debug("widget not found")}return a.log("adf widget !!!!!!!!!"),{replace:!0,restrict:"EA",transclude:!1,templateUrl:e+"widget.html",scope:{definition:"=",col:"=column",editMode:"=",options:"=",widgetState:"="},controller:function(b){var c=0;b.$on("adfDashboardCollapseExapand",function(a,c){b.widgetState.isCollapsed=c.collapseExpandStatus}),b.$on(platformParameters.events.SHOW_LOADER,function(){a.log("SHOW_LOADER"),c++,b.widgetState.isLoading=!0}),b.$on(platformParameters.events.HIDE_LOADER,function(){a.log("HIDE_LOADER"),0===--c&&(b.widgetState.isLoading=!1,a.log("HIDE"))}),b.$on(platformParameters.events.SHOW_PERMISSION_DENIED_TO_MODULE,function(){a.log("SHOW_PERMISSION_DENIED_TO_MODULE"),b.widgetState.permissionDenied=!0}),b.fullScreenMode=!1,b.toggleFullScreenMode=function(){b.fullScreenMode=!b.fullScreenMode,b.$emit("FULL_SCREEN_MODE",b.definition.wid,b.fullScreenMode)}},compile:function(){return{pre:g,post:h}}}}]);var pageControllers=angular.module("pageControllers",[]);pageControllers.controller("PageController",["$scope","$log","$state","$stateParams","PageModel","PageModelParser","toaster",function(a,b,c,d,e,f,g){b.log("PageController");var h=a.model;h||(h={title:"Sample dashboard",structure:"1 (100)",rows:[{columns:[{styleClass:"col-md-12",widgets:[]}]}]}),a.model=h,a.collapsible=!0,a.maximizable=!0;var i=function(b){var c={id:b};e.query(c,function(b){a.pageModelDto={page:b.page,dashboardModuleDtos:b.dashboardModuleDtos},a.name=a.pageModelDto.page.name,a.model=f.createModel(a.pageModelDto),a.collapsible=!0})};d.id&&"application.page"==c.current.name&&i(d.id),a.$on(platformParameters.events.ADF_DASHBOARD_CHANGED_EVENT,function(b,c,d){var e=f.createPageModelDto(a.pageModelDto.page,d);j(e)}),a.$on(platformParameters.events.ADF_STRUCTURE_CHANGED_EVENT,function(b,c){a.pageModelDto.page.layout=c});var j=function(c){b.log("save page-model..."),e.update({id:c.page.id},c,function(c){b.log("page updated"),a.pageModelDto={page:c.page,dashboardModuleDtos:c.dashboardModuleDtos},a.model=f.updateModelModulesNullIds(a.model,c.dashboardModuleDtos),g.pop(platformParameters.statusAlertTypes.SUCCESS,"Updated","The page has been updated successfully.")})}}]),pageControllers.controller("PageDetailsController",["$scope","$rootScope","$http","$state","$parse","$stateParams","$log","$uibModalInstance","Page","Layout","applicationNavigationItems","toaster",function(a,b,c,d,e,f,g,h,i,j,k,l){g.log("PageDetailsController"),a.formErrors=[],a.layouts=[];var m=function(){var b={page:0,size:20,sort:"id,asc"};j.query(b,function(b){a.layouts=b.content})};m(),a.entity={},a.save=function(){return g.log("$scope.entityForm.$invalid: "+a.entityForm.$invalid),g.log("$scope.entityForm.$invalid: ",a.entityForm),a.entityForm.$invalid?(g.log("Form is invalid and could not be saved."),void a.$broadcast("show-errors-check-validity")):(g.log("save() - entity: ",a.entity),void i.save(a.entity,function(c){if(a.entityForm.$setPristine(),g.log("data.form: ",c),angular.forEach(c.form,function(b,c){g.log("fieldName: "+c+", "+b),"id"!==c&&a.entityForm[c].$setValidity("serverMessage",!0)}),0==c.formErrors.length){g.log("Entity has been saved: ",a.entity),h.dismiss();var f={id:c.form.id,title:c.form.title,state:"application.page",orderIndex:k.sidebarItems.length+1,isPage:!0,iconClass:"fa fa-file-text-o"};return k.addSidebarItem(f),l.pop(platformParameters.statusAlertTypes.SUCCESS,"Created","The page has been created successfully."),d.go("application.page",{id:f.id}),void b.$broadcast(platformParameters.events.SIDEBAR_ELEMENT_SELECTED,f.id)}for(var i=0;i<c.formErrors.length;i++){var j=c.formErrors[i].field;g.log("fieldName: "+j);var m=c.formErrors[i].message,n=e("entityForm."+j+".$error.serverMessage");a.entityForm[j].$setValidity("serverMessage",!1),n.assign(a,m)}a.$broadcast("show-errors-check-validity")}))},a.saveForm=function(){g.log("saveForm()"),a.save()},a.cancel=function(){h.dismiss()}}]);var platformPageModule=angular.module("platformPageModule",["ui.router","pageControllers","pageServices","adf","platformLayoutModule"]);platformPageModule.config(["$stateProvider",function(a){a.state("application.welcome",{url:"/welcome",templateUrl:"/application/modules/page/html/index.html",controller:"PageController"}).state("application.page",{url:"/:id",templateUrl:"/application/modules/page/html/model.html",controller:"PageController"})}]);var pageServices=angular.module("pageServices",["ngResource"]);pageServices.factory("Page",["$resource",function(a){return a("api/application/pages/:id",{},{query:{method:"GET",isArray:!1},update:{method:"PUT"},delete:{method:"DELETE"}})}]),pageServices.factory("PageModel",["$resource",function(a){return a("api/pages/:id/model",{},{query:{method:"GET",isArray:!1},update:{method:"PUT"}})}]),pageServices.service("PageModelParser",function(){this.createModel=function(a){var b=JSON.parse(a.page.layout.content);b.description=a.page.description,b.title=a.page.title,b.structure=a.page.layout.title;for(var c=0;c<b.rows.length;c++)for(var d=b.rows[c],e=0;e<d.columns.length;e++){var f=d.columns[e];f.widgets=[]}for(var g=0;g<a.dashboardModuleDtos.length;g++){var h=a.dashboardModuleDtos[g];h.config={},b.rows[h.rowIndex].columns[h.columnIndex].widgets[h.orderIndex]=h}return b},this.createPageModelDto=function(a,b){for(var c=0,d=0,e=0,f=[],g=0;g<b.rows.length;g++){var h=b.rows[g];d=0;for(var i=0;i<h.columns.length;i++){var j=h.columns[i];e=0;for(var k=0;k<j.widgets.length;k++){var l=j.widgets[k];l.rowIndex=c,l.columnIndex=d,l.orderIndex=e,l.frontendId=l.wid,f.push(l),e++}d++}c++}var m={page:a,dashboardModuleDtos:f};return m.page.title=b.title,m},this.findModuleId=function(a,b){for(var c=0;c<b.length;c++)if(b[c].frontendId==a)return b[c].id;return null},this.updateModelModulesNullIds=function(a,b){for(var c=0;c<a.rows.length;c++)for(var d=0;d<a.rows[c].columns.length;d++)for(var e=0;e<a.rows[c].columns[d].widgets.length;e++)null==a.rows[c].columns[d].widgets[e].id&&(a.rows[c].columns[d].widgets[e].id=this.findModuleId(a.rows[c].columns[d].widgets[e].wid,b));return a}});var layoutControllers=angular.module("layoutControllers",["adf.provider"]);layoutControllers.controller("LayoutController",["$scope","$http","$log","Layout","dashboard",function(a,b,c,d,e){a.query=d.query(function(){}),a.read=function(){c.log("query: "+JSON.stringify(a.query));var b={page:0,size:20,sort:"id,asc"};d.query(b,function(b){a.layouts=b.content,a.totalPages=b.totalPages,a.first=b.first,a.last=b.last,a.pageNumber=b.number,angular.forEach(b.content,function(a){e.structure(a.title,a)})})},a.read()}]);var platformLayoutModule=angular.module("platformLayoutModule",["layoutControllers","layoutServices"]),structureServices=angular.module("layoutServices",["ngResource"]);structureServices.factory("Layout",["$resource",function(a){return a("/api/dashboard/:id",{},{query:{method:"GET"},update:{method:"PUT"}})}]);var userControllers=angular.module("userControllers",[]);userControllers.controller("UserDetailsController",["$scope","$http","$state","$stateParams","$log","User","UserPassword","$parse","$uibModalInstance","userId","toaster",function(a,b,c,d,e,f,g,h,i,j,k){e.log("UserDetailsController"),a.user={},a.userGender=["MALE","FEMALE"],a.password={currentPassword:null,newPassword:null,retypeNewPassword:null},a.formErrors=[],a.today=function(){a.user.birthday=new Date},a.today(),a.clear=function(){a.user.birthday=null},a.open=function(b){a.status.opened=!0},a.setDate=function(b,c,d){a.user.birthday=new Date(b,c,d)},a.status={opened:!1},a.user.gender=null,a.cancel=function(){i.dismiss()},a.setFormScope=function(b){a.formScope=b};var l=function(b){e.log("selected user id:",b),b?f.get({id:b},function(b){a.user=b,e.log("User has been got: ",a.user)}):a.user={}};l(j);var m=function(){return a.userForm=a.formScope.userForm,a.selectedForm=a.userForm,e.log("$scope.userForm.$invalid: "+a.userForm.$invalid),e.log("$scope.userForm.$invalid: ",a.userForm),a.userForm.$invalid?(e.log("Form is invalid and could not be saved."),void a.$broadcast("show-errors-check-validity")):(e.log("save() - user: ",a.user),void f.update({id:a.user.id},a.user,function(b){if(a.userForm.$setPristine(),e.log("data.form: ",b),angular.forEach(b.form,function(b,c){e.log("fieldName: "+c+", "+b),"id"!==c&&a.userForm[c].$setValidity("serverMessage",!0)}),0==b.formErrors.length)return e.log("Entity has been saved: ",a.user),i.dismiss(),void k.pop(platformParameters.statusAlertTypes.SUCCESS,"Updated","The account has been updated successfully.");for(var c=0;c<b.formErrors.length;c++){var d=b.formErrors[c].field;e.log("fieldName: "+d);var f=b.formErrors[c].message,g=h("userForm."+d+".$error.serverMessage");a.userForm[d].$setValidity("serverMessage",!1),g.assign(a,f)}a.$broadcast("show-errors-check-validity")}))},n=function(){return a.userChangePasswordForm=a.formScope.userChangePasswordForm,a.selectedForm=a.userChangePasswordForm,e.log("$scope.userChangePasswordForm.$invalid: "+a.userChangePasswordForm.$invalid),e.log("$scope.userChangePasswordForm.$invalid: ",a.userChangePasswordForm),a.userChangePasswordForm.$invalid?(e.log("Form is invalid and could not be saved."),void a.$broadcast("show-errors-check-validity")):(e.log("changeUserPassword() - password:",a.password.currentPassword,a.password.newPassword,a.password.retypeNewPassword),void g.update({id:a.user.id},a.password,function(b){if(a.userChangePasswordForm.$setPristine(),e.log("data.form: ",b),angular.forEach(b.form,function(b,c){e.log("fieldName: "+c+", "+b),"id"!==c&&a.userChangePasswordForm[c].$setValidity("serverMessage",!0)}),0==b.formErrors.length)return e.log("Entity has been saved: ",a.user),i.dismiss(),void k.pop(platformParameters.statusAlertTypes.SUCCESS,"Updated","The password has been changed successfully.");for(var c=0;c<b.formErrors.length;c++){var d=b.formErrors[c].field;e.log("fieldName: "+d);var f=b.formErrors[c].message,g=h("userChangePasswordForm."+d+".$error.serverMessage");a.userChangePasswordForm[d].$setValidity("serverMessage",!1),g.assign(a,f)}a.$broadcast("show-errors-check-validity")}))};a.saveForm=function(){null!=a.user.id&&(a.selectedForm||(a.selectedForm=a.formScope.userForm),"userForm"==a.selectedForm.$name?m():"userChangePasswordForm"==a.selectedForm.$name?n():"userRolesForm"==a.selectedForm.$name)},a.selectForm=function(b){a.selectedForm=b}}]);var userDirectives=angular.module("userDirectives",[]);userDirectives.directive("passwordVerify",function(){return{require:"ngModel",scope:{passwordVerify:"="},link:function(a,b,c,d){a.$watch(function(){var b;return(a.passwordVerify||d.$viewValue)&&(b=a.passwordVerify+"_"+d.$viewValue),b},function(b){b&&d.$parsers.unshift(function(b){var c=a.passwordVerify;return c!==b?void d.$setValidity("passwordVerify",!1):(d.$setValidity("passwordVerify",!0),b)})})}}});var platformUserModule=angular.module("platformUserModule",["userControllers","userDirectives"]);